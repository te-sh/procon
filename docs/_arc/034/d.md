---
number: '034'
problem: D
---
高橋くんが $$ x $$ 枚の赤いカードを引くとして, それらを $$ a_1, a_2, \dots, a_x $$ とする. そして, $$ a_i $$ 枚の後に青いカードを $$ y_i $$ 枚引くとすると, 得点は,

$$
a_1 \prod^{y_1} b_i + a_2 \prod^{y_2} b_i + \dots + a_x \prod^{y_n} b_i
$$

となる. 期待値を計算するときは赤いカードの順序を入れ替えながら平均を求めることになるので, $$ a_i $$ は $$ \{ a_i \} $$ の平均としても計算結果は変わらない. この $$ \{ a_i \} $$ の平均を $$ a $$ とする.

次に $$ \prod b_i $$ の部分であるが, これも期待値を求める際には青いカードの順序を入れ替えながら平均を求めることになる.　$$ y $$ 枚の青いカードの積の平均は, $$ y $$ 枚の青いカードを取ったときの積の総和を $$ y $$ の青いカードを取る組み合わせの数で割ったものとなる.

$$ i $$ 番目のカードまで見たときに $$ j $$ 枚取ったときの積の総和を $$ S(i, j) $$ とすると,

$$
S(i, j) = S(i-1, j) + b_i S(i-1, j-1)
$$

となり, $$ y $$ 枚取ったときの積の平均 $$ V(y) $$ は,

$$
V(y) = \frac{S(B, y)}{ {}_BC_y }
$$

で求められる. これはあらかじめ計算しておく.

最後に残り青いカードが $$ i $$ 枚で赤いカードが $$ j $$ 枚のときの得点の期待値を $$ E(i, j) $$ とすると,

$$
E(i, j) = (E(i-1, j) + aV(b-j))\frac{i}{i+j+C} + E(i, j-1)\frac{j}{i+j+C}
$$

となる.
